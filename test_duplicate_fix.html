<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Duplicate Image Fix Test - ReWear</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #202f4a;
        color: white;
      }
      .test-section {
        background: white;
        color: #202f4a;
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
      }
      .success {
        color: green;
        font-weight: bold;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      .warning {
        color: orange;
        font-weight: bold;
      }
      .form-group {
        margin-bottom: 15px;
      }
      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #e91e63;
      }
      .form-group input {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 14px;
      }
      .image-preview {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 10px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid #e9ecef;
      }
      .image-preview img {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border-radius: 5px;
        border: 2px solid #ddd;
      }
      .log {
        background: #f5f5f5;
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: monospace;
        max-height: 200px;
        overflow-y: auto;
      }
      .test-info {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
      }
    </style>
  </head>
  <body>
    <h1>üîß Duplicate Image Fix Test</h1>

    <div class="test-section">
      <h2>Test Duplicate Image Prevention</h2>
      <div class="test-info">
        <p>
          <strong>Issue Fixed:</strong> Images were showing twice when selecting
          multiple files
        </p>
        <p>
          <strong>Solution:</strong> Added flag to prevent duplicate event
          listeners
        </p>
        <p>
          <strong>Expected:</strong> Each selected image should appear only once
          in preview
        </p>
      </div>

      <div class="form-group">
        <label>Upload Photos (You can upload more than one)</label>
        <input type="file" id="testImages" accept="image/*" multiple />
        <div
          id="testImagePreview"
          class="image-preview"
          style="display: none"
        ></div>
      </div>

      <div id="testResult" style="margin-top: 10px"></div>
    </div>

    <div class="test-section">
      <h2>Test Results</h2>
      <div id="testLog" class="log"></div>
    </div>

    <script>
      let imagePreviewInitialized = false;

      function log(message, type = "info") {
        const logDiv = document.getElementById("testLog");
        const timestamp = new Date().toLocaleTimeString();
        const color =
          type === "error"
            ? "red"
            : type === "success"
            ? "green"
            : type === "warning"
            ? "orange"
            : "blue";
        logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      // Test multiple image upload with duplicate prevention
      document.addEventListener("DOMContentLoaded", function () {
        const imageInput = document.getElementById("testImages");
        const previewDiv = document.getElementById("testImagePreview");
        const resultDiv = document.getElementById("testResult");

        log("Setting up duplicate prevention test...", "info");

        if (imageInput) {
          // Simulate the same logic as the main events page
          if (!imagePreviewInitialized) {
            log(
              "Initializing image preview functionality (first time)",
              "info"
            );

            imageInput.addEventListener("change", function (e) {
              const files = e.target.files;
              log(
                `Selected ${files.length} files: ${Array.from(files)
                  .map((f) => f.name)
                  .join(", ")}`,
                "info"
              );

              if (files.length > 0) {
                previewDiv.innerHTML = "";
                previewDiv.style.display = "block";

                Array.from(files).forEach((file, index) => {
                  log(`Processing file ${index + 1}: ${file.name}`, "info");

                  const reader = new FileReader();
                  reader.onload = function (e) {
                    const img = document.createElement("img");
                    img.src = e.target.result;
                    img.title = file.name;
                    previewDiv.appendChild(img);
                    log(`‚úÖ Preview added for ${file.name}`, "success");
                  };
                  reader.onerror = function (error) {
                    log(`‚ùå Error reading ${file.name}: ${error}`, "error");
                  };
                  reader.readAsDataURL(file);
                });

                // Check for duplicates
                const images = previewDiv.querySelectorAll("img");
                const uniqueImages = new Set(
                  Array.from(images).map((img) => img.title)
                );

                if (images.length === uniqueImages.size) {
                  resultDiv.innerHTML = `<span class="success">‚úÖ SUCCESS: ${images.length} images shown, no duplicates!</span>`;
                  log(
                    `‚úÖ No duplicates detected. Images shown: ${images.length}`,
                    "success"
                  );
                } else {
                  resultDiv.innerHTML = `<span class="error">‚ùå FAILED: ${images.length} images shown, but only ${uniqueImages.size} unique files!</span>`;
                  log(
                    `‚ùå Duplicates detected! Images shown: ${images.length}, Unique files: ${uniqueImages.size}`,
                    "error"
                  );
                }
              } else {
                previewDiv.style.display = "none";
                resultDiv.innerHTML =
                  '<span class="warning">‚ö†Ô∏è No files selected</span>';
              }
            });

            imagePreviewInitialized = true;
            log(
              "‚úÖ Image preview functionality initialized with duplicate prevention",
              "success"
            );
          } else {
            log(
              "‚ö†Ô∏è Image preview already initialized, skipping duplicate setup",
              "warning"
            );
          }
        } else {
          log("‚ùå Image input not found!", "error");
        }
      });
    </script>
  </body>
</html>
