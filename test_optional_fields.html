<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Optional Fields Test - ReWear</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 0 auto;
        padding: 20px;
        background: #202f4a;
        color: white;
      }
      .test-section {
        background: white;
        color: #202f4a;
        padding: 20px;
        margin: 20px 0;
        border-radius: 10px;
      }
      .success {
        color: green;
        font-weight: bold;
      }
      .error {
        color: red;
        font-weight: bold;
      }
      .warning {
        color: orange;
        font-weight: bold;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #45a049;
      }
      .log {
        background: #f5f5f5;
        border: 1px solid #ddd;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-family: monospace;
        max-height: 200px;
        overflow-y: auto;
      }
      .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin: 10px 0;
      }
      .checkbox-group label {
        display: flex;
        align-items: center;
        gap: 5px;
      }
    </style>
  </head>
  <body>
    <h1>üîß Optional Fields & New Clothing Types Test</h1>

    <div class="test-section">
      <h2>Test Event Creation with Optional Fields</h2>
      <p>
        This test verifies that End Date and Time fields are optional, and all
        new clothing types work correctly.
      </p>

      <button onclick="testOptionalFields()">
        Test Event with Optional Fields
      </button>
      <button onclick="testAllClothingTypes()">Test All Clothing Types</button>
      <button onclick="testRequiredFieldsOnly()">
        Test Required Fields Only
      </button>

      <div id="testResult" style="margin-top: 10px"></div>
    </div>

    <div class="test-section">
      <h2>Clothing Types Available</h2>
      <div class="checkbox-group">
        <label><input type="checkbox" value="Children" /> üë∂ Children</label>
        <label><input type="checkbox" value="Adult" /> üëï Adult</label>
        <label
          ><input type="checkbox" value="Baby Clothes" /> üë∂ Baby Clothes</label
        >
        <label><input type="checkbox" value="Winter" /> üß• Winter</label>
        <label
          ><input type="checkbox" value="Daily Wear" /> üëî Daily Wear</label
        >
        <label
          ><input type="checkbox" value="Sportswear" /> üßò Sportswear</label
        >
        <label
          ><input type="checkbox" value="Traditional Wear" /> üëö Traditional
          Wear</label
        >
        <label
          ><input type="checkbox" value="Scarves and Shawls" /> üß£ Scarves and
          Shawls</label
        >
        <label><input type="checkbox" value="Footwear" /> üëû Footwear</label>
        <label
          ><input type="checkbox" value="Accessories" /> üß§ Accessories</label
        >
        <label><input type="checkbox" value="Other" /> üß∫ Other</label>
      </div>
    </div>

    <div class="test-section">
      <h2>Test Results</h2>
      <div id="testLog" class="log"></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <script src="js/firebase.js"></script>

    <script>
      function log(message, type = "info") {
        const logDiv = document.getElementById("testLog");
        const timestamp = new Date().toLocaleTimeString();
        const color =
          type === "error"
            ? "red"
            : type === "success"
            ? "green"
            : type === "warning"
            ? "orange"
            : "blue";
        logDiv.innerHTML += `<div style="color: ${color};">[${timestamp}] ${message}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
      }

      // Test event creation with optional fields
      async function testOptionalFields() {
        const resultDiv = document.getElementById("testResult");

        if (!window.auth.currentUser) {
          log("Signing in anonymously...", "info");
          try {
            await window.auth.signInAnonymously();
            log("Anonymous sign in successful", "success");
          } catch (error) {
            log(`Sign in failed: ${error.message}`, "error");
            return;
          }
        }

        log("Testing event creation with optional fields...", "info");
        resultDiv.innerHTML =
          '<span class="warning">‚è≥ Creating test event...</span>';

        try {
          const eventId = window.db.ref("events").push().key;
          log(`Generated event ID: ${eventId}`, "info");

          const testEvent = {
            eventId: eventId,
            eventName: "Optional Fields Test Event",
            organizerName: "Test Organizer",
            organizerEmail: "test@example.com",
            organizerPhone: "1234567890",
            typeOfOrganizer: "NGO",
            location: "Test Location",
            startDate: "2025-01-01",
            endDate: "", // Optional - empty
            time: "", // Optional - empty
            registrationDeadline: "2024-12-31",
            description:
              "This event tests optional fields (no end date, no time)",
            clothTypes: ["Children", "Adult"],
            posterUrl: "",
            proofImageUrl: "",
            createdAt: new Date().toISOString(),
            createdBy: window.auth.currentUser.uid,
          };

          await window.db.ref(`events/${eventId}`).set(testEvent);
          log("Event saved with optional fields empty", "success");

          // Verify the event was created
          const savedEvent = await window.db
            .ref(`events/${eventId}`)
            .once("value");
          const eventData = savedEvent.val();
          log(`Event verified: ${eventData.eventName}`, "success");
          log(`End Date: "${eventData.endDate}" (should be empty)`, "info");
          log(`Time: "${eventData.time}" (should be empty)`, "info");

          // Clean up
          await window.db.ref(`events/${eventId}`).remove();
          log("Test event cleaned up", "success");

          resultDiv.innerHTML =
            '<span class="success">‚úÖ Optional fields test successful!</span>';
        } catch (error) {
          log(`Test failed: ${error.message}`, "error");
          resultDiv.innerHTML = `<span class="error">‚ùå Test failed: ${error.message}</span>`;
        }
      }

      // Test all clothing types
      async function testAllClothingTypes() {
        const resultDiv = document.getElementById("testResult");

        if (!window.auth.currentUser) {
          log("Signing in anonymously...", "info");
          try {
            await window.auth.signInAnonymously();
            log("Anonymous sign in successful", "success");
          } catch (error) {
            log(`Sign in failed: ${error.message}`, "error");
            return;
          }
        }

        log("Testing all clothing types...", "info");
        resultDiv.innerHTML =
          '<span class="warning">‚è≥ Creating test event with all clothing types...</span>';

        try {
          const eventId = window.db.ref("events").push().key;
          log(`Generated event ID: ${eventId}`, "info");

          const allClothingTypes = [
            "Children",
            "Adult",
            "Baby Clothes",
            "Winter",
            "Daily Wear",
            "Sportswear",
            "Traditional Wear",
            "Scarves and Shawls",
            "Footwear",
            "Accessories",
            "Other",
          ];

          const testEvent = {
            eventId: eventId,
            eventName: "All Clothing Types Test Event",
            organizerName: "Test Organizer",
            organizerEmail: "test@example.com",
            organizerPhone: "1234567890",
            typeOfOrganizer: "NGO",
            location: "Test Location",
            startDate: "2025-01-01",
            endDate: "2025-01-02",
            time: "10:00",
            registrationDeadline: "2024-12-31",
            description: "This event tests all available clothing types",
            clothTypes: allClothingTypes,
            posterUrl: "",
            proofImageUrl: "",
            createdAt: new Date().toISOString(),
            createdBy: window.auth.currentUser.uid,
          };

          await window.db.ref(`events/${eventId}`).set(testEvent);
          log("Event saved with all clothing types", "success");

          // Verify the event was created
          const savedEvent = await window.db
            .ref(`events/${eventId}`)
            .once("value");
          const eventData = savedEvent.val();
          log(`Event verified: ${eventData.eventName}`, "success");
          log(`Clothing types count: ${eventData.clothTypes.length}`, "info");
          log(`Clothing types: ${eventData.clothTypes.join(", ")}`, "info");

          // Clean up
          await window.db.ref(`events/${eventId}`).remove();
          log("Test event cleaned up", "success");

          resultDiv.innerHTML =
            '<span class="success">‚úÖ All clothing types test successful!</span>';
        } catch (error) {
          log(`Test failed: ${error.message}`, "error");
          resultDiv.innerHTML = `<span class="error">‚ùå Test failed: ${error.message}</span>`;
        }
      }

      // Test required fields only
      async function testRequiredFieldsOnly() {
        const resultDiv = document.getElementById("testResult");

        if (!window.auth.currentUser) {
          log("Signing in anonymously...", "info");
          try {
            await window.auth.signInAnonymously();
            log("Anonymous sign in successful", "success");
          } catch (error) {
            log(`Sign in failed: ${error.message}`, "error");
            return;
          }
        }

        log("Testing required fields only...", "info");
        resultDiv.innerHTML =
          '<span class="warning">‚è≥ Creating test event with required fields only...</span>';

        try {
          const eventId = window.db.ref("events").push().key;
          log(`Generated event ID: ${eventId}`, "info");

          const testEvent = {
            eventId: eventId,
            eventName: "Required Fields Only Test Event",
            organizerName: "Test Organizer",
            organizerEmail: "test@example.com",
            organizerPhone: "1234567890",
            typeOfOrganizer: "NGO",
            location: "Test Location",
            startDate: "2025-01-01",
            endDate: "",
            time: "",
            registrationDeadline: "2024-12-31",
            description: "This event has only required fields filled",
            clothTypes: ["Children"],
            posterUrl: "",
            proofImageUrl: "",
            createdAt: new Date().toISOString(),
            createdBy: window.auth.currentUser.uid,
          };

          await window.db.ref(`events/${eventId}`).set(testEvent);
          log("Event saved with required fields only", "success");

          // Verify the event was created
          const savedEvent = await window.db
            .ref(`events/${eventId}`)
            .once("value");
          const eventData = savedEvent.val();
          log(`Event verified: ${eventData.eventName}`, "success");
          log(`Start Date: ${eventData.startDate}`, "info");
          log(`End Date: "${eventData.endDate}" (empty)`, "info");
          log(`Time: "${eventData.time}" (empty)`, "info");

          // Clean up
          await window.db.ref(`events/${eventId}`).remove();
          log("Test event cleaned up", "success");

          resultDiv.innerHTML =
            '<span class="success">‚úÖ Required fields only test successful!</span>';
        } catch (error) {
          log(`Test failed: ${error.message}`, "error");
          resultDiv.innerHTML = `<span class="error">‚ùå Test failed: ${error.message}</span>`;
        }
      }

      // Initialize
      window.addEventListener("load", function () {
        log("Optional fields test page loaded", "info");
        log("Ready to test optional fields and new clothing types", "info");
      });
    </script>
  </body>
</html>
